#!/bin/bash

DIR=$(dirname $(realpath $0))

dotinstall() {
	if [ -e ~/.$1 ]; then

		if diff ~/.$1 $DIR/$1; then
			echo "Skipping $1..."
			return
		fi

		NEWFILE=$1.$(date +%F_%T)
		echo "Renaming $1 to $NEWFILE..."
		mv ~/$1 ~/$NEWFILE
	fi

	mkdir -p $(dirname ~/$1)

	echo "Linking $1...."
	ln -sf $DIR/$1 ~/.$1
}

setup_vim() {
	cd $DIR && git submodule init && git submodule update
}

case $1 in
	deps|dependencies)
		if [ -f /usr/bin/apt-get ]; then
			sudo /usr/bin/apt-get install coreutils realpath
		elif [ -f /usr/bin/yum ]; then
			sudo /usr/bin/yum install coreutils
		fi
		;;

	clean)
		rm -f ~/.bash_profile.*
		rm -f ~/.bashrc.*
		rm -f ~/.gtkrc-2.0.*
		rm -f ~/.screenrc.*
		rm -f ~/.vim.*
		rm -f ~/.vimrc.*
		rm -f ~/.taskrc.*
		rm -f ~/.XCompose.*
		rm -f ~/.Xresources.*
		rm -f ~/.gitconfig.*
		;;

	*)
		dotinstall bash_profile
		dotinstall bashrc
		dotinstall gtkrc-2.0
		dotinstall screenrc
		dotinstall vimrc
		dotinstall vim
		dotinstall taskrc
		dotinstall XCompose
		dotinstall Xresources
		dotinstall inputrc
		dotinstall gitconfig
		setup_vim
		;;
esac

